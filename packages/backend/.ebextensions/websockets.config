option_settings:
  aws:elbv2:listener:default:
    DefaultActions: '[{"Type":"forward","TargetGroupName":"AWSEBV2LoadBalancerTargetGroup"}]'
    Rules: ''
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: ''
  # Enable sticky sessions for the target group
  aws:elbv2:targetgroup:AWSEBV2LoadBalancerTargetGroup:
    TargetType: instance
    Protocol: HTTP
    Port: 80 # Or whatever your Node app listens on internally if not mapped by EB proxy
    HealthCheckIntervalSeconds: 10
    HealthCheckTimeoutSeconds: 5
    HealthyThresholdCount: 3
    UnhealthyThresholdCount: 5
    Matcher: # Health check expects 200
      HttpCode: 200
    StickinessEnabled: true # Enable Sticky Sessions
    StickinessType: lb_cookie # Use Load Balancer generated cookie
    StickinessLBCookieDurationSeconds: 86400 # Cookie duration (e.g., 1 day)
  # Increase proxy idle timeout (optional but good for long-lived connections)
  aws:elasticbeanstalk:application:environment:
    # Set Node command, if needed (often handled by Procfile)
    # NODE_COMMAND: "node dist/main.js"
    AWS_ELB_IDLE_TIMEOUT: '3600' # Set ELB idle timeout to 1 hour (adjust as needed)